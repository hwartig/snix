Snix.Record=function(e,t){var n={},r=function(r,i){this.id=s.val(),console.info(r),this.canCreate=s.compute(function(){return this.id()==null},this),this.canSave=s.compute(function(){return this.id()!=null},this),this.canDelete=s.compute(function(){return this.id()!=null},this),this.url=s.compute(function(){return(i!=null?i.url():"")+e+"/"+this.id()},this);var o={create:[],save:[],"delete":[]};this.on=function(e,t,n){o[e].push(_.bind(t,n||this))};var u=_.keys(t);this.delete=function(){return s.delete(this.url()).success(function(){_.invoke(o["delete"],"call",null)}).error(function(e){alert(e)}),this},this.save=function(){return s.put(this.url(),_.pick(this,u)).success(function(){_.invoke(o.save,"call",null)}).error(function(e){alert(e)}),this},this.create=function(){return s.post(this.url(),_.pick(this,this.attributes)).success(function(e){this.id(e.id),_.invoke(o.create,"call",null)},this).error(function(e){alert(e)}),this},r=r||{},r.id&&this.id(r.id);for(var a in t){var f=t[a],l=r[a]===undefined?f[1]:r[a];l!=null&&f[2]&&(l=f[2].apply(l,[l])),this[a]=f[0](l)}for(var a in n){var c=n[a];this[a]=s.array();var h=this;this[a].load=function(){return s.get(h.url()+c.baseUrl).success(function(e){h[a](_.map(e,function(e){return new c(e,h)}))},this).error(function(e){alert("err: "+e)}),this},this[a].reload=function(){return this([]),this.load()}}};return r.all=function(t){var n=s.array();return n.load=function(){var t=this;return s.get(e).success(function(e){t(_.map(e,function(e){return new r(e)}))}).error(function(e){alert("err: "+e)}),this},n.reload=function(){return this([]),this.load()},t||n.load(),n},r.find=function(t){var n=s.val();return n.load=function(){var t=this;return s.get(e).success(function(e){t(new r(e))}).error(function(e){alert("err: "+e)}),this},n.reload=function(){return this(null),this.load()},n.load(),n},r.hasMany=function(e,t){n[e]=t},r.baseUrl=e,r};
var Snix={};Snix.__caller__=null,Snix.val=function(e){return(new Snix.Value(arguments.length>0?e:null)).boundFun()},Snix.compute=function(e,t,n){var r=!1,i=new Snix.Value(null),s=i.set,o=i.get;return i.set=function(e){if(!n)throw"compute does not have a writer";n(e)},i.get=function(){return r||(r=!0,this.evalValue()),o.apply(this)},i.evalValue=function(){this.isDisposed||Snix.callAs(function(){s.apply(i,[e.apply(t)])},i)},i.boundFun().tap(function(){this.forceEvalValue=_.bind(i.evalValue,i)})},Snix.callAs=function(e,t,n){var r=Snix.__caller__;Snix.__caller__=t,e.apply(n||this),Snix.__caller__=r},Snix.unwrap=function(e){return e&&e.__Snix__?Snix.unwrap(e()):e},Snix.idOf=function(e){return(typeof e=="string"||typeof e=="number"?e:e.id).toString()},function(){Snix.bindings={},Snix.parse=function(e){return _.map(e.split(";"),function(e){var t=e.indexOf(":"),n=e.substring(0,t).replace(/\s/g,""),r=e.substring(t+1,e.length).replace(/^(\s)*/g,"");return[n,r]})},Snix.accessor=function(e,t,n){return e=e.replace(/@/g,"this."),function(){var r=null;try{return arguments.length==0?(new Function(_.keys(n),"return "+e)).apply(t,_.values(n)):(new Function(_.keys(n).concat(["value"]),e+"(value);")).apply(t,_.values(n).concat([arguments[0]]))}catch(i){throw"expr: "+e+", err: "+i}}},Snix.binden=function(e,t,n){n=arguments.length>2?n:{},_.each($(t).toArray(),function(t){var r=$(t).attr("data-bind");if(r){var i=Snix.parse(r);_.each(i,function(r){var i=r[0],s=r[1],o=Snix.accessor(s,e,n),u=Snix.bindings[i];if(!u)throw"unknown binding: "+i;var a={context:e,vars:n};u.init&&u.init.apply(a,[t,o]);if(u.update){var f=Snix.compute(function(){u.update.apply(a,[t,o])});$(t).on("destroyed",function(){f.dispose(!0)}),f()}})}else $(t).children().each(function(){Snix.binden(e,this,n)})})}}(),function(){Snix.bindings.check={init:function(e,t){$(e).on("change",function(){t($(e).is(":checked"))})},update:function(e,t){Snix.unwrap(t())?$(e).attr("checked","checked"):$(e).removeAttr("checked")}}}(),function(){Snix.bindings.click={init:function(e,t){$(e).on("click",function(e){e.preventDefault(),t()})}}}(),function(){Snix.bindings.css={update:function(e,t){var n=Snix.unwrap(t());for(var r in n)n[r]?$(e).addClass(r):$(e).removeClass(r)}}}(),function(){Snix.bindings.date={init:function(e,t){var n=Snix.unwrap(t());n.caption=n.caption||{year:"Year",month:"Month",day:"Day"},$(e).empty();var r=moment(),i=[["year",r.year()-80,r.year()+10,n.caption.year],["month",1,12,n.caption.month],["day",1,31,n.caption.day]];_.each(i,function(t){var r=$("<select class='"+t[0]+"'></select>");r.append("<option value='-1'>"+t[3]+"</option>");for(var i=t[1];i<=t[2];i++){var s=i<10?"0"+i:i;$("<option value="+i+">"+s+"</option>").appendTo(r)}r.appendTo(e),$(r).on("change",function(){var t=parseInt($("select.year option:selected",e).val(),10),r=parseInt($("select.month option:selected",e).val(),10),i=parseInt($("select.day option:selected",e).val(),10);t!=-1&&r!=-1&&i!=-1?n.moment(moment(new Date(t,r-1,i)).startOf("day")):Snix.unwrap(n.moment)&&($("select option[value='-1']",e).attr("selected","selected"),n.moment(null))})})},update:function(e,t){var n=Snix.unwrap(t()),r=Snix.unwrap(n.moment);r?($("select.year option[value='"+r.year()+"']",e).attr("selected","selected"),$("select.month option[value='"+(r.month()+1)+"']",e).attr("selected","selected"),$("select.day option[value='"+r.date()+"']",e).attr("selected","selected")):$("select option[value='-1']",e).attr("selected","selected")}}}(),function(){Snix.bindings.log={update:function(e,t){window.console&&window.console.log(Snix.unwrap(t()))}}}(),function(){Snix.bindings.loop={init:function(e,t){this.tpl=$(e).html(),$(e).empty()},update:function(e,t){var n=t(),r=Snix.unwrap(n.entries),i=_.map(r,function(e){return Snix.idOf(e)}),s=$("> [data-id]",e).map(function(){return $(this).attr("data-id")}).toArray();i.length==s.length&&i.toString()!=s.toString()&&$(e).empty();if(s.length>0){var o=_(s).chain().difference(i).map(function(e){return"[data-id='"+e+"']"}).value().join(",");$(o,e).remove()}_.each(i,function(t){if(!_.include(s,t)){var i=_.detect(r,function(e){return Snix.idOf(e)==t}),o=$(this.tpl);o.attr("data-id",t),o.appendTo(e);var u=_.defaults({},this.vars);u[n.as]=i,Snix.callAs(function(){Snix.binden(this.context,o,u)},null,this)}},this)}}}(),function(){Snix.bindings.radio={init:function(e,t){var n=t();$(e).on("change",function(){var e=$(this).attr("data-id");n.selected(_.detect(Snix.unwrap(n.entries),function(t){return Snix.idOf(t)==e}))}),$(e).attr("data-id",Snix.idOf(n.entry))},update:function(e,t){var n=t(),r=Snix.unwrap(n.selected);r?$(e).parents("form").find("input[name='"+$(e).attr("name")+"'][data-id='"+Snix.idOf(r)+"']").attr("checked","checked"):$(e).parents("form").find("input[name='"+$(e).attr("name")+"']").removeAttr("checked")}}}(),function(){Snix.bindings.select={init:function(e,t){var n=t();n.multiple&&$(e).attr("multiple","multiple"),$(e).on("change",function(){var t=_.map($("option:selected",e).toArray(),function(e){return $(e).attr("value")});if(n.multiple){var t=_.map($("option:selected",e).toArray(),function(e){return $(e).attr("value")});t.length==0?n.selected(null):n.selected(_.select(Snix.unwrap(n.entries),function(e){return _.include(t,Snix.idOf(e))}))}else{var r=$("option:selected",e).attr("value");r==-1?n.selected(null):n.selected(_.detect(Snix.unwrap(n.entries),function(e){return Snix.idOf(e)==r}))}})},update:function(e,t){var n=t();$(e).empty();if(!n.multiple){var r=Snix.unwrap(n.caption)||"Please Choose";$("<option value='-1'>"+r+"</option>").appendTo(e)}var i=Snix.unwrap(n.label);_.each(Snix.unwrap(n.entries),function(t){var n=i?Snix.unwrap(t[i]):t.toString();$("<option value='"+Snix.idOf(t)+"'>"+n+"</option>").appendTo(e)});var s=Snix.unwrap(n.selected);n.multiple?s&&_.each(s,function(t){$("option[value='"+Snix.idOf(t)+"']",e).attr("selected","selected")}):s?$("option[value='"+Snix.idOf(s)+"']",e).attr("selected","selected"):$("option[value='-1']",e).attr("selected","selected")}}}(),function(){Snix.bindings.text={update:function(e,t){$(e).text(Snix.unwrap(t()))}}}(),function(){Snix.bindings.toggle={init:function(e,t){this.tpl=$(e).html()},update:function(e,t){if(Snix.unwrap(t())){$(e).empty().show();var n=$(this.tpl);n.appendTo(e);var r=_.defaults({},this.vars);Snix.callAs(function(){Snix.binden(this.context,n,r)},null,this)}else $(e).hide().empty()}}}(),function(){Snix.bindings.value={init:function(e,t){$(e).on("change",function(){t($(this).val())})},update:function(e,t,n,r){$(e).val(Snix.unwrap(t()))}}}(),function(){Snix.jQuery=function(){var e=jQuery.cleanData;$.cleanData=function(t){for(var n=0,r;(r=t[n])!==undefined;n++)jQuery(r).triggerHandler("destroyed");e(t)}}}(),function(){Snix.array=function(e){var t=new Snix.Value(arguments.length>0?e:[]);return t.boundFun().tap(function(){this.add=function(e){return t.fun(_.union(t.fun(),[e])),this},this.remove=function(e){return t.fun(_.without(t.fun(),e)),this},this.clear=function(){return t.fun([]),this},this.size=function(){return t.fun().length},this.isEmpty=function(){return t.fun().length==0}})}}(),function(){Snix.enu=function(){var e=[];for(var t=0;t<arguments.length;t++){var n={id:t,name:arguments[t]};n.toString=function(){return this.name},e.push(n)}var r=function(){if(arguments.length==0)return e;var t=_.where(e,{name:arguments[0]})[0];if(!t)throw"unknown in enumeration: "+arguments[0];return t};return r}}(),function(){Snix.errors=function(){var e=new Snix.Value({});return e.boundFun().tap(function(){this.clear=function(){this({})},this.validate=function(e,t){var n={};for(var r in e)e[r].apply(t)||(n[r]=!0);return this(n),this.isEmpty()},this.isEmpty=function(){return _.size(this())==0}})}}(),function(){Snix.remote=function(e,t){var n=Snix.val(null);t=arguments.length>1?t:function(e){return e};var r=Snix.compute(function(){var r=typeof e=="function"?e():e;return r&&$.getJSON(r.toString()).success(function(e){n(t(e))}),null});return r(),n.reload=function(){r.forceEvalValue()},n},Snix.remoteArray=function(e,t){var n=Snix.array([]);t=arguments.length>1?t:function(e){return e};var r=Snix.compute(function(){var r=typeof e=="function"?e():e;return r&&$.getJSON(r.toString()).success(function(e){n(_.map(e,t))}),null});return r(),n.reload=function(){r.forceEvalValue()},n}}(),function(){var e=function(e,t){var n=new Snix.Value(arguments.length>0?e:null),r=n.set;return n.set=function(e){r.apply(n,[t(e)])},n.boundFun()};Snix.intVal=function(t){return e(t,function(e){return e==null?null:parseInt(e,10)})},Snix.floatVal=function(t){return e(t,function(e){return e==null?null:parseFloat(e)})},Snix.boolVal=function(t){return e(t,function(e){return e==null?null:e==1||e=="true"||e=="yes"})}}(),function(){Snix.Value=function(e){this.value=e,this.dependants=[],this.isDisposed=!1,this.subscriptions=[]},Snix.Value.prototype.get=function(){return this.trackCaller(),this.value},Snix.Value.prototype.set=function(e){this.value!==e&&(this.value=e,this.dependants=_.reject(this.dependants,function(e){return e.isDisposed}),_.invoke(this.dependants,"evalValue"))},Snix.Value.prototype.trackCaller=function(){Snix.__caller__!=null&&!_.include(this.dependants,Snix.__caller__)&&this.dependants.push(Snix.__caller__)},Snix.Value.prototype.fun=function(){if(arguments.length==0)return this.get();this.set(arguments[0])},Snix.Value.prototype.dispose=function(e){this.isDisposed=!0,e&&(this.value=null)},Snix.Value.prototype.notifySubscriber=function(){_.each(this.subscriptions,function(e){e[0].apply(e[1])})},Snix.Value.prototype.subscribe=function(e,t){this.subscriptions.push([e,t||this])},Snix.Value.prototype.unsubscribe=function(e){this.subscriptions=_.reject(this.subscriptions,function(t){return t[0]===e})},Snix.Value.prototype.boundFun=function(){var e=_.bind(this.fun,this);return e.dispose=_.bind(this.dispose,this),e.__Snix__=!0,e.tap=_.bind(function(t){return t.apply(e),e},this),e}}();